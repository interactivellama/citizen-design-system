import CodeView from '../../../shared/components/CodeView';
import CodeBlock from '../../../shared/components/CodeBlock';
import Blockquote from '../../../shared/components/Blockquote';
import Example from '../../../shared/components/Example';
import Combobox, {ComboboxGroup} from './';
import ObjectSwitcher from './object-switcher/';
import Listbox, { ListboxGroup, ListboxWrapper, Option } from './listbox/';
import ListboxOfSelections from './listbox-of-pills/';
import ButtonIcon from '../button-icons/';
import { UtilityIcon } from '../icons/base/example';
import { StandardIcon } from '../icons/standard/example';
import * as Snapshot from './snapshots.data';
import _ from '../../shared/helpers';

<div className="lead doc">
  A widget that provides a user with an input field that is either an autocomplete or readonly, accompanied with a listbox of options.
</div>

## Base Combobox

A Base Combobox is a readonly text input that allows a user to select an option from a pre-defined list of options. It does not allow free form user input, nor does it allow the user to modify the selected value.

<Example title="Combobox - Base">
  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-1"
      readonly
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-1" snapshot={Snapshot.ObjectOptions} type="plain" count={8} visualSelection />}
    hasInteractions
  />
</CodeView>
</Example>

### Combobox markup

- A Combobox must come with an associated `label` element, with an appropriate `for` attribute
- `slds-combobox` acts as the root node to the composite Combobox widget. It takes the `role="combobox"` attribute as a result
  - `aria-haspopup="listbox"` attribute is then applied to indicate the Combobox will display a popup, of type `listbox`
  - `aria-expanded="true|false"` attribute is applied to describe whether the popup of `listbox` is currently visible or not
- The element `slds-combobox__form-element` between the `combobox` and it's `input` must have `role="none"`

### Textbox markup

- The Textbox is an `input` with a role of `textbox`. The role is implicit on inputs, but in this case it doesn't hurt to be explicit
- The Textbox has `autocomplete="off"` to remove the browsers suggestions from the `input`
- The Textbox has `aria-controls=""` which points to the ID of the `listbox`. It informs Assistive Technology what DOM node the input controls, in display or content
- The Textbox has the `type` attribute set to be `text` as it's not a search field
- The Textbox has `readonly` attribute applied

### Displaying options

To display the `Listbox` of options in a Combobox, it is most common that the user will click and place their focus inside the text input and the options will display instantly. Optionally, you can choose to not display the `Listbox` immediately and wait for user input by means of typing a letter or pressing the down arrow key, before displaying the options.

To toggle visibility of the `Listbox` add the class `slds-is-open` to the `slds-dropdown-trigger` element.

<Blockquote type="a11y" header="Accessibility Requirement">
  When toggling visibility of the Combobox, the <code className="doc">aria-expanded</code> attribute needs to be toggled to <code className="doc">true</code>, remembering to set it to <code className="doc">false</code> again when the options are hidden.
</Blockquote>

<Blockquote type="a11y" header="Accessibility Note">
  The <code className="doc">listbox</code> of options must be an <b>owned</b> child of the <code className="doc">combobox</code>. If it cannot be a direct child of the <code className="doc">combobox</code> element then <code className="doc">aria-owns</code> must be placed on the <code className="doc">combobox</code> an point to the ID of the <code className="doc">listbox</code> instead.
</Blockquote>

<Example title="Combobox - Displaying Options">
  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-2"
      readonly
      value="Accounts"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={
        <Listbox
          id="listbox-id-2"
          snapshot={Snapshot.ObjectOptions}
          type="plain"
          count={8}
          visualSelection
        />
      }
      isOpen
      hasFocus
    />
  </CodeView>
</Example>

#### Listbox markup

- The `listbox` has `role="listbox"` applied
- The `listbox` can have child `option`'s. We place `role="option"` on a `span` element, inside a list item. As such the list item `li` needs to be removed from the Accessibility Tree with `role="presentation"`
- A `listbox` has the ability to group options together under a visual heading or label. This means the `role="listbox"` attribute is placed on a common parent element, which can wrap multiple lists (or groups) of options
  - When a `listbox` has no option groups
    - The `ul` element has `role="presentation"` to remove it from the Accessibility Tree
- Every `option` has `aria-selected="false"` by default
- Disabled `option`s should have `aria-disabled="true"` applied

### Grouped options

Options within a Listbox can be grouped together under meaningful headings. This is useful if you wish to create separation between 2 or more sets of options within a single Listbox.

<Example title="Combobox - Grouped Options">
  <CodeView style={{maxWidth: '40rem', height: '17rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-3"
      readonly
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
          />
        }
        listbox={
          <ListboxWrapper id="listbox-id-3" className="slds-dropdown slds-dropdown_fluid">
            <ListboxGroup
            aria-label="Group One"
            snapshot={Snapshot.PlainOptionsGroupOne}
            count={3}
            />
            <ListboxGroup
            aria-label="Group Two"
            snapshot={Snapshot.PlainOptionsGroupTwo}
            count={3}
          />
        </ListboxWrapper>
      }
      isOpen
      hasFocus
    />
  </CodeView>
</Example>

#### Grouped Listbox markup

- When a `listbox` has option groups, each group gets a visual label. Exactly like `optgroup` in a `select` element
  - The `ul` element in this case has `role="group"` with an `aria-label` that matches the visible label
  - Display the group label visually, but due to the way a listbox works it can only be marked as `role="presentation"`, as a `listbox` can only have `option` children. This allows us to communicate the group label visually and programmatically to a screen reader

### Handling focus

When a combobox is clicked or focused, it is common for the options to be displayed at the same time. When you leave the combobox it is also common that the options are hidden.

When an option from the `Listbox` is "in focus", user focus never leaves the `input` field, we manually create a programmatic or "faux focus" state that highlights the selected option and associates it to the `input`.

<Blockquote type="a11y" header="Accessibility Requirement">
  When highlighting an option with "faux focus", the <code className="doc">aria-activedescendant</code> attribute on the input needs to be set to the value of the ID of the highlighted option. The highlighted option must also have <code className="doc">aria-selected="true"</code>.
</Blockquote>

<Example title="Combobox - Handling focus">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-4"
    readonly
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="down"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title={false}
      />
    }
    listbox={<Listbox id="listbox-id-4" snapshot={Snapshot.ObjectOptionsFocused} type="plain" count={8} visualSelection />}
    aria-activedescendant="option1"
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

### Keyboard interaction

To use a combobox with your keyboard, you must first place focus inside the `input`. From here:

- If the Combobox is collapsed, use the `down` arrow key to expand it, updating `aria-expanded` to `true`
- Use the `Escape` key to collapse the Combobox, uppdating `aria-expanded` to `false`
- Use `up` or `down` arrow keys to cycle through the options, updating `aria-activedescendant` and setting `aria-selected="true"` on the next option with each key press
  - Each press of the arrow key **must** update the `input` value to reflect the currently selected option
  - It is common to loop the selected option to the first option when you get to the last option in the list. Similarly looping to the last option when you reach to the first option.
- By typing the first letter of an option name, the first matching option will highlight, updating aria-activedescendant` and setting `aria-selected="true"` on the option
  - When the letter doesn't match an option, highlighting don't move
- `Enter` will select the highlighted option

### Selecting an option

A user selects an option by using their mouse to click the option they require, or pressing the `Enter` key once they have arrowed to the desired option.

Upon selection the Combobox collapses, only showing the input field. The value of the input inside the Combobox is set to match the selected option name so the user can see what was previously selected from the `Listbox` of options.

<Example title="Combobox - Selecting an Option">

  <div className="docs-codeblock-example">
    <div style={{maxWidth: '40rem'}}>
      <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-5"
      readonly
      value="Accounts"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
        symbol="down"
        className="slds-icon slds-icon_x-small slds-icon-text-default"
        containerClassName="slds-input__icon slds-input__icon_right"
        assistiveText={false}
        title={false}
        />
      }
      listbox={
        <Listbox
        id="listbox-id-5"
        snapshot={Snapshot.ObjectOptionsSingleSelection}
        type="plain"
        count={8}
        visualSelection
        />
      }
      />
    </div>
  </div>

</Example>

#### Single selection

When an option become selected, the class `slds-is-selected` should be applied to the `slds-listbox__option` element with the `role="option"`. This will provide visual feedback that the user has selected that element.

<Example title="Combobox - Single Selection">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-6"
    readonly
    value="Accounts"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="down"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title={false}
      />
    }
    listbox={
      <Listbox
      id="listbox-id-6"
      snapshot={Snapshot.ObjectOptionsSingleSelection}
      type="plain"
      count={8}
      visualSelection
      />
    }
    aria-activedescendant="option1"
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

##### Re-opening with a selection

When re-opening a Combobox that already has a selected value, the Listbox should be displayed with the selected option already highlighted.

<Blockquote type="a11y" header="Accessibility Requirement">
  Be sure to re-set the <code className="doc">aria-activedescendant</code> attribute on the input to the value of the ID of the highlighted option. The highlighted option must also have <code className="doc">aria-selected="true"</code>.
</Blockquote>

#### Multiple selections

When more than one option has been selected, the value of the input should be updated with the total number of selected items, such as "3 options selected".

<Blockquote type="a11y" header="Accessibility Note">
  The value of the Combobox is the only way you can communicate what option was selected to a screen reader. Given that the option names don't appear in the set value, adding "Current Selection:" to each selected option name allows a screen reader user to understand that the option was already selected from the list.
</Blockquote>

<CodeBlock toggleCode={false}>
  <Option
    name="Accounts"
    selected
  />
</CodeBlock>

<Example title="Combobox - Multiple Selections">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-7"
    readonly
    value="2 Options Selected"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="down"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title={false}
      />
    }
    listbox={
      <Listbox
      id="listbox-id-7"
      snapshot={Snapshot.ObjectOptionsMultiSelection}
      type="plain"
      count={8}
      visualSelection
      />
    }
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

When a Combobox with multiple selected options is closed, a listbox of pills is also used to represent those selected options.

The listbox of pills is positioned below the read-only input, outside of the Combobox, each pill represents a selected option. This allows a user to easily see and remove selected items from the Combobox without opening it again.

<Example title="Combobox - Multiple selection closed">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-8"
    readonly
    value="2 Options Selected"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="down"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title={false}
      />
    }
    listbox={
      <Listbox
      id="listbox-id-8"
      snapshot={Snapshot.ObjectOptionsMultiSelection}
      type="plain"
      count={8}
      visualSelection
      />
    }
    listboxOfSelections={
      <ListboxOfSelections
      snapshot={Snapshot.ObjectOptionsSelected}
      count={2}
      />
    }
    />
  </CodeView>

</Example>

#### Editing multiple selections

The Listbox of Pills allows you to quickly remove selections without opening the Combobox by clicking the remove "x" or using your delete key.

The Listbox of Pills acts as a single focusable element. Using the arrow keys whilst focused on the first pill, will cycle the user through the pill options.

## Autocomplete combobox

An autocomplete Combobox also allows a user to select an option from a list but that list can be affected by what the user types into the input of the Combobox. This can be useful when the list of options is very large, as user input can start to display options that only match the text they have entered.

If no option matches, the user can complete the value of the combobox by finishing their own text entry.

<Blockquote type="a11y" header="Accessibility difference">
  The difference between the <strong>base combobox</strong> and the <strong>autocomplete combobox</strong>, is that the text <code className="doc">input</code> must have the <code className="doc">readonly</code> attribute removed and replaced with <code className="doc">aria-autocomplete="list"</code>.
</Blockquote>

<Example title="Combobox - Autocomplete">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-9"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title="Search"
      />
    }
    listbox={<Listbox id="listbox-id-9" snapshot={Snapshot.PlainOptions} type="plain" count={3} />}
    hasInteractions
    />
  </CodeView>

</Example>

### Displaying options

Displaying options happens just like a base Combobox, by placing user focus inside the Combobox text input.

When a user stops interacting with the Combobox, or selects an option, the Combobox collapses and hides the options.

<Example title="Combobox - Autocomplete - Displaying Options">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-10"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title="Search"
      />
    }
    listbox={<Listbox id="listbox-id-10" snapshot={Snapshot.PlainOptions} type="plain" count={3} />}
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

### Displaying options based on user input

If an option from the pre-populated Listbox isn't what the user wants they can start typing into the input. This term will be used to filter the options by and narrow down the size of the list to something more relevant.

Whilst typing, the highlighted option in the listbox should be the users text string.

<Blockquote type="a11y" header="Accessibility Requirement">
  When highlighting an option with "faux focus", the <code className="doc">aria-activedescendant</code> attribute on the input needs to be set to the value of the ID of the highlighted option. The highlighted option must also have <code className="doc">aria-selected="true"</code>.
</Blockquote>

<Example title="Combobox - Autocomplete - Displaying options based on user input">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-11"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title="Search"
      />
    }
    value="opp"
    listbox={<Listbox id="listbox-id-11" snapshot={Snapshot.PlainOptionsTypeahead} term="opp" type="plain" count={4} />}
    aria-activedescendant="option1"
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

### Keyboard interaction

The same keyboard interactions apply from the base Combobox, but with these differences:

- `Up` and `Down` arrows **should optionally** update the `input` value to reflect the currently selected option

<Example title="Combobox - Autocomplete - Keyboard interactions">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-12"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title="Search"
      />
    }
    listbox={<Listbox id="listbox-id-12" snapshot={Snapshot.PlainOptionsFocused} type="plain" count={3} />}
    aria-activedescendant="option1"
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

### Selecting an option

The user again can click on the desired option or press the `Enter` key with the desired option highlighted. Alternatively they can leave their entered text string as the value of the Combobox.

Selecting an option from the Listbox will close the Listbox.

To remove the selected option, simply clear the text input.

<Example title="Combobox - Autocomplete - Selecting an option">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-unique-id-03"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title="Search"
      />
    }
    listbox={<Listbox id="listbox-unique-id-03" snapshot={Snapshot.PlainOptions} type="entity" count={3} />}
    value="GenePoint"
    />
  </CodeView>

</Example>

### Multiple selection

Multiple selection is much the same as the Base Combobox, a list of selected options are displayed below the Combobox as a Listbox of Pills.

<Example title="Combobox - Autocomplete - Multiple selections">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-13"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      assistiveText={false}
      title="Search"
      />
    }
    listbox={<Listbox id="listbox-id-13" snapshot={Snapshot.PlainOptions} type="entity" count={3} />}
    hasSelection
    listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.PlainOptionsSelected} count={2} />}
    />
  </CodeView>

</Example>

#### Editing Multiple selections

The Listbox of Pills allows you to quickly remove selections without opening the Combobox by clicking the remove "x" or using your delete key.

The Listbox of Pills acts as a single focusable element. Using the arrow keys whilst focused on the first pill, will cycle the user through the pill options.

## Entity Autocomplete Combobox (Lookup)

An Entity Autocomplete Combobox or Lookup, is used to search for and select Salesforce Entities.

<Example title="Combobox - Autocomplete - Entity">

  <CodeView style={{maxWidth: '40rem', height: '10rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-14"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    listbox={<Listbox id="listbox-id-14" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
    hasInteractions
    />
  </CodeView>

</Example>

### Displaying options

Displaying options happens just like an Autocomplete Combobox, by placing user focus inside the Combobox text input.

The options now have extra information about them, such as the type of entity and any other important meta data.

<Example title="Combobox - Autocomplete - Entity - Displaying options">

  <CodeView style={{maxWidth: '40rem', height: '10rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-15"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    listbox={<Listbox id="listbox-id-15" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

### Displaying options based on user input

As with the Autocomplete Combobox the user can start typing into the input to search for Salesforce Entities that match their search term.

In the resultant displayed options, we highlight the matched term by bolding it using the `<mark>` element.

<Example title="Combobox - Autocomplete - Entity - Displaying options based on user input">
  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-16"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
        />
      }
      value="salesforce"
      listbox={<Listbox id="listbox-id-16" snapshot={Snapshot.EntityOptionsTypeahead} term="salesforce" type="entity" count={4} />}
      aria-activedescendant="option1"
      isOpen
      hasFocus
    />
  </CodeView>
</Example>

### Keyboard interaction

The same keyboard interactions apply from the base Combobox, but with these differences:

- `Up` and `Down` arrows **should not** update the `input` value to reflect the currently selected option. The input value should only be updated upon selection.

<Example title="Combobox - Autocomplete - Entity - Keyboard interactions">

  <CodeView style={{maxWidth: '40rem', height: '10rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-17"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    listbox={<Listbox id="listbox-id-17" snapshot={Snapshot.EntityOptionsFocused} type="entity" count={2} />}
    aria-activedescendant="option1"
    isOpen
    hasFocus
    />
  </CodeView>

</Example>

### Selecting an option

The user again can click on the desired option or press the `Enter` key with the desired option highlighted. The user can only select from the returned options, a plain text string is not a valid selection with the Entity Lookup.

The selected option is still set as the value of the text `input`, but this time we make the input look like a dismissable pill. This `input` becomes readonly at this point, so the user can no longer type into it.

To remove the selected option, simply press the `Delete` key when focused inside the text `input` or click the remove "x".

<Blockquote type="a11y" header="Accessibility Requirement">
  When the option is selected, make sure to add the <code className="doc">readonly</code> attribute to the text <code className="doc">input</code>. Be sure to remove it again when the option is cleared.
</Blockquote>

<Example title="Combobox - Autocomplete - Entity - Single selection">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-18"
    inputIconPosition="left-right"
    leftInputIcon={
      <StandardIcon
      symbol="account"
      className="slds-icon_small"
      containerClassName="slds-combobox__input-entity-icon"
      />
    }
    rightInputIcon={
      <ButtonIcon
      className="slds-input__icon slds-input__icon_right"
      symbol="close"
      title="Remove selected option"
      assistiveText="Remove selected option"
      />
    }
    listbox={<Listbox id="listbox-id-18" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
    hasSelection
    value="Salesforce.com, Inc."
    readonly
    />
  </CodeView>

</Example>

## Multiple selection

Multiple selection is handled the same as the base and autocomplete combobox, a list of selected entities is display under the combobox as a Listbox of Pills.

<Example title="Combobox - Autocomplete - Entity - Multiple Selection">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-19"
    autocomplete
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    listbox={<Listbox id="listbox-id-19" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
    hasSelection
    listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={2} />}
    />
  </CodeView>

</Example>

## Grouped Comboboxes (Cross-entity / Polymorphic)

The Grouped Comboboxes should be used when a combobox has another text input addon prepended or appended to the primary combobox.

The containing `div` of the comboboxes should have the class `slds-combobox-group` on it.

<Blockquote type="warning" header="Keep in mind">
  The grouped combobox only accepts <em>one</em> addon, in addition to the primary combobox. Use the classes <code className="doc">slds-combobox_addon-start</code> and <code className="doc">slds-combobox_addon-end</code> to describe the position of the form element.
</Blockquote>

<Blockquote type="a11y" header="Accessibility Requirement">
  Be sure to set <code className="doc">aria-controls</code> on the Object Switcher, which points to the Search Combobox ID.
</Blockquote>

<Example title="Combobox - Grouped">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-20"
    comboboxID="primary-combobox-id-1"
    autocomplete
    listbox={<Listbox id="listbox-id-20" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
    addon={<ObjectSwitcher value="Accounts" addonPosition="start" hasInteractions comboboxAriaControls="primary-combobox-id-1" />}
    addonPosition="start"
    comboboxPosition="end"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    hasInteractions
    />
  </CodeView>

</Example>

### User input (Typeahead)

<Example title="Combobox - Grouped - User input">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-21"
    comboboxID="primary-combobox-id-2"
    autocomplete
    listbox={<Listbox id="listbox-id-21" snapshot={Snapshot.EntityOptionsTypeahead} term="salesforce" type="entity" count={4} />}
    value="salesforce"
    isOpen
    hasFocus
    addon={ <ObjectSwitcher value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-2" /> }
    addonPosition="start"
    comboboxPosition="end"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    />
  </CodeView>

</Example>

### Selecting options

<Example title="Combobox - Grouped - Selecting options">

  <CodeView style={{maxWidth: '40rem'}}>
    <ComboboxGroup
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-22"
    comboboxID="primary-combobox-id-3"
    autocomplete
    listbox={<Listbox id="listbox-id-22" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
    hasFocus
    addon={ <ObjectSwitcher value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-3" /> }
    addonPosition="start"
    comboboxPosition="end"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    hasSelection
    listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={2} />}
    />
  </CodeView>

</Example>

### User input with selection(s) made

<Example title="Combobox - Grouped - User inptu with selections made">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-23"
    comboboxID="primary-combobox-id-4"
    autocomplete
    listbox={<Listbox id="listbox-id-23" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
    isOpen
    hasFocus
    addon={ <ObjectSwitcher value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-4" /> }
    addonPosition="start"
    comboboxPosition="end"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    hasSelection
    listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={2} />}
    />
  </CodeView>

</Example>

### Selected options overflow

When a user is not focused on any element inside of the combobox group, the pill container should become collapsed to reduce vertical space.

The combobox group element needs the class `slds-has-selection` when a selection has been made. The pill selections are found inside of another listbox located after the combobox group. It requires the class `slds-listbox_selection-group` to provide appropiate styling for the exanding and collapsing behavior of this region.

#### Collapsed

By default, the `slds-listbox_selection-group` is collapsed.

<Example title="Combobox - Grouped - Collapsed pills">

  <CodeView style={{maxWidth: '40rem'}}>
    <ComboboxGroup
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-24"
    comboboxID="primary-combobox-id-5"
    autocomplete
    listbox={<Listbox id="listbox-id-24" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
    addon={ <ObjectSwitcher value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-5" /> }
    addonPosition="start"
    comboboxPosition="end"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    hasSelection
    listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={8} />}
    />
  </CodeView>

</Example>

#### Expanded

When a user focuses on _any_ element inside of the combobox group, the class `slds-is-expanded` should be applied to the `slds-listbox_selection-group`. The selection group should remain opened until the user removes focus from the combobox group.

<Example title="Combobox - Grouped - Expanded pills">

  <CodeView style={{maxWidth: '40rem'}}>
    <ComboboxGroup
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-25"
    comboboxID="primary-combobox-id-6"
    autocomplete
    listbox={<Listbox id="listbox-id-25" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
    hasFocus
    addon={ <ObjectSwitcher value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-6" /> }
    addonPosition="start"
    comboboxPosition="end"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    hasSelection
    listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={8} isExpanded />}
    />
  </CodeView>

</Example>

### Scoping Results

A grouped combobox is intended to be used to filer down or scope you search results. You can do so by interacting with the object switcher to scope down to an object type.

The containing element should receive the class `slds-combobox_object-switcher` and `slds-combobox_addon-start`.

#### Text variant

<Example title="Combobox - Grouped - Scoping text variant">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
    id={_.uniqueId('combobox-id-')}
    aria-controls="listbox-id-26"
    comboboxID="primary-combobox-id-7"
    autocomplete
    listbox={<Listbox id="listbox-id-26" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
    addon={ <ObjectSwitcher value="Accounts" addonPosition="start" isOpen hasFocus comboboxAriaControls="primary-combobox-id-7" /> }
    addonPosition="start"
    comboboxPosition="end"
    inputIconPosition="right"
    rightInputIcon={
      <UtilityIcon
      symbol="search"
      className="slds-icon slds-icon_x-small slds-icon-text-default"
      containerClassName="slds-input__icon slds-input__icon_right"
      />
    }
    />
  </CodeView>

</Example>
