// Copyright (c) 2015-present, salesforce.com, inc. All rights reserved
// Licensed under BSD 3-Clause - see LICENSE.txt or git.io/sfdc-license

/**
 * @name base
 * @selector .slds-path
 * @restrict div
 * @variant
 * @s1 false
 */
.slds-path {
  /**
   * @summary Indicates the coaching section is expanded
   *
   * @selector .slds-is-expanded
   * @restrict .slds-path
   */
  &.slds-is-expanded {
    padding-bottom: $var-spacing-vertical-small;
    border-color: $color-border;
  }
}

/**
 * @summary Allows the path itself to be responsive
 *
 * @selector .slds-path__track
 * @restrict .slds-path div
 */
.slds-path__track {
  padding-top: $var-spacing-vertical-small;
  padding-bottom: $var-spacing-vertical-small;
  padding-left: $spacing-small;
  padding-right: $spacing-small;

  /**
   * Indicates the scroller is in the overflow state
   *
   * @selector .slds-has-overflow
   * @restrict .slds-path__track
   */
  &.slds-has-overflow {
    /**
     *
     * @summary Allows the path to scroll when necessary
     *
     * @selector .slds-path__scroller_inner
     * @restrict .slds-path__scroller div
     */
    .slds-path__scroller_inner {
      display: flex;
      width: 100%;
      overflow: hidden;
    }

    .slds-path__scroller-container {
      overflow: hidden;
    }

    .slds-path__scroll-controls {
      display: inline-flex;
      flex-shrink: 0;
      padding-left: $spacing-x-small;
    }
  }
}

/**
 * @summary Creates the scrolling container for tab overflow
 *
 * @selector .slds-path__scroller
 * @restrict .slds-path__track div
 */
.slds-path__scroller {
  flex: 1;
  max-width: 100%;
  overflow: hidden;
}

/**
 * @summary Container for the buttons that control the scrolling
 *
 * @selector .slds-path__scroll-controls
 * @restrict .slds-path__track div
 *
 */
.slds-path__scroll-controls {
  display: none;
}

/**
 * @summary Shows the stage name when in the smaller state
 *
 * @selector .slds-path__stage-name
 * @restrict .slds-path__track span
 *
 */
.slds-path__stage-name {
  display: none;
}

/**
 * @summary Creates the container for toggle button and path
 *
 * @selector .slds-path__scroller-container
 * @restrict .slds-path div
 */
.slds-path__scroller-container {
  flex: 1;
  margin-right: $spacing-large;
}

/**
 * @summary Container for path actions
 *
 * @selector .slds-path__action
 * @restrict .slds-path div
 */
.slds-path__action {
  flex-shrink: 0;
}

// these mixins exist in order to alias selector assignment in the case
// where state cannot be applied to the individual path step
@mixin is-won() {

  .slds-path__link,
  &:hover .slds-path__link {
    border: 0;
    line-height: $line-height-salespath;
    color: $color-text-inverse;
    background-color: $color-background-path-won;
  }

  &:before,
  &:after,
  &:hover:before,
  &:hover:after {
    background-image: linear-gradient(225deg, $color-background-path-won, $color-background-path-won 1.125rem, transparent 1.125rem);
  }
}

@mixin is-lost() {

  .slds-path__link,
  &:hover .slds-path__link {
    border: 0;
    line-height: $line-height-salespath;
    color: $color-text-inverse;
    background-color: $color-background-path-lost;
  }

  &:before,
  &:after,
  &:hover:before,
  &:hover:after {
    background-image: linear-gradient(225deg, $color-background-path-lost, $color-background-path-lost 1.125rem, transparent 1.125rem);
  }
}

/**
 * @summary Horizontal list of stages in path component
 *
 * @selector .slds-path__nav
 * @restrict .slds-path__scroller_inner ul
 */
.slds-path__nav {
  display: flex;
  align-items: flex-start;
  overflow: hidden;

  /**
  * @summary Creates the incomplete stage of the path
  *
  * @selector .slds-is-incomplete
  * @restrict .slds-path__item
  */
  .slds-is-incomplete {

    .slds-path__link {
      color: $color-text-default;
      background-color: $color-background-path-incomplete;
    }

    &:before,
    &:after {
      background-image: linear-gradient(225deg, $color-background-path-incomplete, $color-background-path-incomplete 1.125rem, transparent 1.125rem);
    }

    &:hover {

      .slds-path__link {
        background-color: $color-background-path-incomplete-hover;
      }

      &:before,
      &:after {
        background-image: linear-gradient(225deg, $color-background-path-incomplete-hover, $color-background-path-incomplete-hover 1.125rem, transparent 1.125rem);
      }
    }
  }

  /**
   * @summary Creates the completed stage of the path
   *
   * @selector .slds-is-complete
   * @restrict .slds-path__item
   */
  .slds-is-complete {

    .slds-path__stage {
      transform: translateY(-50%) rotateX(0deg);
    }

    .slds-path__title {
      transform: rotateX(180deg);
    }

    .slds-path__link {
      color: $color-text-action-label-active;
      background-color: $color-background-path-complete;
    }

    &:before,
    &:after {
      background-image: linear-gradient(225deg, $color-background-path-complete, $color-background-path-complete 1.125rem, transparent 1.125rem);
    }

    &:hover {

      .slds-path__stage {
        transform: translateY(-50%) rotateX(-180deg);
      }

      .slds-path__title {
        transform: rotateX(0deg);
      }

      .slds-path__link {
        background-color: $color-background-path-complete-hover;
        color: $color-text-inverse;
      }

      &:before,
      &:after {
        background-image: linear-gradient(225deg, $color-background-path-complete-hover, $color-background-path-complete-hover 1.125rem, transparent 1.125rem);
      }
    }
  }

  /**
   * @summary Creates the current stage of the path
   *
   * @selector .slds-is-current
   * @restrict .slds-path__item
   */
  .slds-is-current {

    .slds-path__link {
      background-color: $color-background-path-current;
      line-height: ($line-height-salespath - 0.25rem);
      border-top: $width-path-border-current solid $color-border-path-current;
      border-bottom: $width-path-border-current solid $color-border-path-current;
      color: $color-text-path-current;
    }

    &:before {
      background-image: linear-gradient(225deg, $color-border-path-current, $color-border-path-current 1.125rem, transparent 1.125rem);
    }

    &:after {
      background-image: linear-gradient(225deg, $color-background-path-current, $color-background-path-current 1.125rem, transparent 1.125rem);
      box-shadow: inset -0.125rem 0.125rem 0 0 $color-border-path-divider,
        inset -0.25rem 0.25rem 0 0 $color-border-path-current;
    }

    &:first-child .slds-path__link {
      border-left: $width-path-border-current solid $color-border-path-current;
    }

    &:hover {

      .slds-path__link {
        border-color: $color-border-path-current-hover;
      }

      &:before {
        background-image: linear-gradient(225deg, $color-border-path-current-hover, $color-border-path-current-hover 1.125rem, transparent 1.125rem);
      }

      &:after {
        box-shadow: inset -0.125rem 0.125rem 0 0 $color-border-path-divider,
          inset -0.25rem 0.25rem 0 0 $color-border-path-current-hover;
      }
    }
  }

  /**
   * @summary Creates the active stage of the sales path
   *
   * @selector .slds-is-active
   * @restrict .slds-path__item
   * @notes This class must be placed on the item programatically when the guidance section is activated
   */
  .slds-is-active {

    .slds-path__stage {
      transform: translateY(-50%) rotateX(-180deg);
    }

    .slds-path__title {
      transform: rotateX(0deg);
    }

    .slds-path__link {
      border: 0;
      color: $color-text-inverse;
      background-color: $color-background-path-active;
      line-height: $line-height-salespath;
    }

    &:before,
    &:after {
      background-image: linear-gradient(225deg, $color-background-path-active, $color-background-path-active 1.125rem, transparent 1.125rem);
    }

    &:after {
      box-shadow: inset -0.125rem 0.125rem 0 0 $color-border-path-divider;
    }

    &:hover {

      .slds-path__link {
        background-color: $color-background-path-active-hover;
      }

      &:before,
      &:after {
        background-image: linear-gradient(225deg, $color-background-path-active-hover, $color-background-path-active-hover 1.125rem, transparent 1.125rem);
      }

      &:after {
        box-shadow: inset -0.125rem 0.125rem 0 0 $color-border-path-divider;
      }
    }
  }

  /**
   * @summary Creates lost stage of the path
   *
   * @selector .slds-is-lost
   * @restrict .slds-path__item
   * @notes This class must be added to the "closed" stage with JS when the Sales Path is complete and the opportunity is lost
   */
  .slds-is-lost {
    @include is-lost();
  }

  /**
   * @summary Creates success stage of the path
   *
   * @selector .slds-is-won
   * @restrict .slds-path__item
   */
  .slds-is-won {
    @include is-won();
  }
}

// alias selectors for assigning won/lost to the path parent
.slds-path.slds-is-won .slds-path__item.slds-is-current {
  @include is-won();
}

.slds-path.slds-is-lost .slds-path__item.slds-is-current {
  @include is-lost();
}


// Note: Order matters. Keep the path__item below the above selectors

/**
 * @summary Individual stages of a path
 *
 * @selector .slds-path__item
 * @restrict .slds-path__nav li
 */
.slds-path__item {
  position: relative;
  flex: 1;
  min-width: 5rem;
  text-align: center;
  transition:
    transform 0.1s ease-in-out,
    background-color 0.1s linear;

  &:first-child .slds-path__link {
    border-radius: $border-radius-pill 0 0 $border-radius-pill;
  }

  &:last-child .slds-path__link {
    border-radius: 0 $border-radius-pill $border-radius-pill 0;
    padding: $spacing-xx-small $spacing-medium $spacing-xx-small ($spacing-medium + $spacing-xx-small);
  }

  &:first-child:last-child .slds-path__link {
    border-radius: $border-radius-pill;
  }

  &:before,
  &:after {
    content: '';
    display: block;
    position: absolute;
    top: 0;
    bottom: 0;
    width: $height-sales-path;
    transform: scale(0.74, 1) rotate(45deg);
    cursor: pointer;
  }

  // sets left border for current step (mostly invisible)
  &:before {
    left: ((($height-sales-path / 2) + 0.0625rem) * -1);
    z-index: 9;
  }

  // sets right arrow for current step (overlaps :before of following element)
  &:after {
    right: ((($height-sales-path / 2) - 0.1875rem) * -1);
    background-size: calc(100% - 0.125rem) calc(100% - 0.125rem);
    background-position: bottom left;
    background-repeat: no-repeat;
    box-shadow: inset -0.125rem 0.125rem 0 0 $color-border-path-divider;
    z-index: 10;
  }

  &:first-child:before,
  &:last-child:after {
    display: none;
  }
}


/**
 * @summary Contains the name of the stage
 *
 * @selector .slds-path__title
 * @restrict .slds-path__link span
 */
.slds-path__title {
  @include truncate;
}

/**
 * @summary Contains the check mark when the stage is completed
 *
 * @selector .slds-path__stage
 * @restrict .slds-path__link span
 */
.slds-path__stage {
  position: absolute;
  top: 50%;
  // left: 50%;
  left: ($square-icon-medium-content / 2);
  width: 100%;
  transform: translateY(-50%) rotateX(-180deg);
}


/**
 * @summary Creates actionable element inside of each path item
 *
 * @selector .slds-path__link
 * @restrict .slds-path__item a
 */
.slds-path__link {
  display: flex;
  justify-content: center;
  position: relative;
  padding: $spacing-xx-small $spacing-xx-small $spacing-xx-small ($spacing-medium + $spacing-xx-small);
  line-height: $line-height-salespath;
  height: $height-sales-path;
  text-decoration: none;
  cursor: pointer; // needed in case links have no href & use JS

  &:hover {
    text-decoration: none;
  }

  &:focus {
    outline: 0;
  }
}

.slds-path__title,
.slds-path__stage {
  display: block;
  transition: transform 0.2s linear;
  // we should be able to get rid of this prefix once this issue is fixed
  // https://github.com/postcss/autoprefixer/issues/653
  // stylelint-disable property-no-vendor-prefix
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/**
 * @summary Button that toggles visibility of stage's tabpanel
 *
 * @selector .slds-path__trigger
 * @restrict .slds-path button
 */
.slds-path__trigger {
  margin-right: $spacing-small;
  border-radius: $border-radius-circle;
  transition: $duration-slowly transform ease-in-out;
}

// @TODO: Move to global utility?
// NOTE: These are deprecated in SLDS Path (no longer used - see trigger_open below)
.slds-flip_vertical,
.slds-flip--vertical {
  transform: rotateX(180deg);
}

.slds-flip_horizontal,
.slds-flip--horizontal {
  transform: rotateY(180deg);
}

.slds-path__trigger_open {
  transform: rotate(90deg);
}

/**
 * @summary Actionable button that invokes a completion of the path
 *
 * @selector .slds-path__mark-complete
 * @restrict .slds-path button
 */
.slds-path__mark-complete {
  border-radius: $border-radius-pill;
  min-width: $path-button-width-fixed;
}

/**
 * @summary Actionable button that invokes a current stage of the path
 *
 * @selector .slds-path__mark-current
 * @restrict .slds-path button, .slds-path-coach button
 */
.slds-path__mark-current {
  border-color: $brand-accessible;
  background-color: $brand-accessible;

  &:hover,
  &:focus {
    background-color: $brand-accessible-active;
  }
}

/**
 * @summary Tabpanel of each stage of the path
 *
 * @selector .slds-path__content
 * @restrict .slds-path div
 */

/**
 * @summary Key field section of expanded tabpanel
 *
 * @selector .slds-path__keys
 * @restrict .slds-path__content div
 */
.slds-path__keys {
  padding-left: $spacing-small;
}

/**
 * @summary Guidance section of expanded tabpanel
 *
 * @selector .slds-path__guidance
 * @restrict .slds-path__content div
 */
.slds-path__guidance {
  margin-right: $spacing-x-small;
  padding-left: $spacing-small;
  padding-bottom: $spacing-xx-small;
  background-color: $color-background-guidance;
}

// Layout adjustments for sub section sof expanded tabpanel
.slds-path__keys,
.slds-path__guidance {
  flex: 1 0 50%;
  margin-top: $var-spacing-vertical-medium;
  padding-right: $spacing-small;
}

/**
 * @summary This creates the underlined titles in the coaching area
 *
 * @selector .slds-path__coach-title
 * @restrict .slds-path__keys div, .slds-path__guidance h2
 */
.slds-path__coach-title {
  margin-bottom: $spacing-x-small;
  border-bottom: $color-border $border-width-thin solid;
  padding-bottom: $spacing-x-small;
  font-size: $font-size-heading-x-small;
  text-transform: uppercase;
  letter-spacing: 0.0625rem;
  line-height: 1.125; // to align heading in Guidance (due to edit button)
}

/**
 * @summary The Edit link in Path Coaching
 *
 * @selector .slds-path__coach-edit
 * @restrict .slds-path__coach-title button
 */
.slds-path__coach-edit {
  border: 0;
  padding: 0;
  line-height: inherit;
}

/**
 * @summary This creates the space at the top of the guidance area
 *
 * @selector .slds-path__guidance-content
 * @restrict .slds-path__guidance div
 */
.slds-path__guidance-content {
  padding-top: $var-spacing-vertical-xx-small;
}

/**
 * @summary This class should be placed on a containing div when the Path container is between 565px and 1280px
 *
 * @selector .slds-region_medium
 * @restrict div
 */
.slds-region_medium {

  .slds-path__scroller-container {
    flex-basis: 100%;
    margin-right: 0;
  }

  .slds-path__track {
    @include flex-wrap(true);
  }

  .slds-path__action {
    flex-grow: 1;
    flex-basis: 100%;
    justify-content: space-between;
    align-items: center;
    margin-top: $spacing-medium;
    padding-left: ($spacing-small + $square-icon-medium-boundary);
  }

  .slds-path__stage-name {
    display: block;
  }

  .slds-path__content:not(.slds-is-collapsed) {
    border-top: $border-width-thin solid $color-border;
  }
}

/**
 * @summary This class should be placed on a containing div when the Path container is between 360px and 564px
 *
 * @selector .slds-region_medium
 * @restrict div
 */
.slds-region_small {

  .slds-path__scroller-container {
    flex-basis: 100%;
    margin-right: 0;
  }

  .slds-path__track,
  .slds-path__coach {
    @include flex-wrap(true);
  }

  .slds-path__coach {
    padding: 0 $spacing-small;
  }

  .slds-path__stage-name {
    display: block;
    margin: $spacing-medium 0;
  }

  .slds-path__action {
    flex-grow: 1;
    flex-basis: 100%;
    flex-direction: column;
    align-items: center;
  }

  .slds-path__mark-complete {
    margin-right: 0;
  }

  .slds-path__keys,
  .slds-path__guidance {
    flex-basis: 100%;
    padding-left: 0;
    padding-right: 0;
  }

  .slds-path__guidance {
    margin-top: $spacing-medium;
  }
}
